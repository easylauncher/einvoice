<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link 
  href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" 
  rel="stylesheet"
/>

<title>Invoice Generator</title>
<style>
  body {
    font-family: 'Roboto', sans-serif;
    background: #f9f9f9;
  }

  .invoice-container {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 0.9rem;
    padding: 20px;
  }

  .invoice-logo img {
    width: 200px;
    max-height: 200px;
    object-fit: contain;
  }

  @media print {
    /* Hide everything except the invoice */
    /* body * {
      visibility: hidden;
      display: none !important;
    } */
    #user_section, #user_section * {
      visibility: hidden;
      display: none !important;
    }

    #invoice, #invoice * {
      visibility: visible;
      /* display: block !important; */
    }
    #invoice {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
    }
    #title, .download-btn, .share-btn, .print-btn, .back-btn {
      display: none !important;
    }
  }
</style>
</head>
<body>


<script>
// Set this to true for testing mode.
const TEST_MODE = true;
</script>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold" href="#">InvoiceGen</a>
  </div>
</nav>

<div class="container my-4">
  <h1 id="title" class="mb-4 text-center fw-bold">Invoice Generator</h1>
  <div class="row g-4">
    <!-- Form Section -->
    <div id="user_section" class="col-12 col-lg-5">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <h2 class="h5 mb-4">Input Details</h2>
          <div class="mb-3">
            <label for="startDate" class="form-label">Journey Start Date</label>
            <input type="date" class="form-control" id="startDate" />
          </div>
          <div class="mb-3">
            <label for="startMeter" class="form-label">Journey Start Meter Reading (KM)</label>
            <input type="number" class="form-control" id="startMeter" placeholder="e.g. 1200" />
          </div>
          <div class="mb-3">
            <label for="endDate" class="form-label">Journey End Date</label>
            <input type="date" class="form-control" id="endDate" />
          </div>
          <div class="mb-3">
            <label for="endMeter" class="form-label">Journey End Meter Reading (KM)</label>
            <input type="number" class="form-control" id="endMeter" placeholder="e.g. 1480" />
          </div>
          <div class="mb-3">
            <label for="toll" class="form-label">Toll Charges</label>
            <input type="number" step="0.01" class="form-control" id="toll" placeholder="e.g. 45.00" />
          </div>
          <div class="mb-3">
            <label for="extras" class="form-label">Extra Expenses</label>
            <input type="number" step="0.01" class="form-control" id="extras" placeholder="e.g. 100.00" />
          </div>
          <div class="mb-3">
            <label for="costPerKm" class="form-label">Cost per KM</label>
            <input type="number" step="0.01" class="form-control" id="costPerKm" placeholder="e.g. 5.00" />
          </div>
          <button class="btn btn-primary w-100" id="generateBtn">Generate Invoice</button>
        </div>
      </div>
    </div>

    <!-- Invoice Section -->
    <div class="col-12 col-lg-7">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <h2 class="h5 mb-4">Invoice Preview</h2>
          <div id="invoice" class="invoice-container d-none">
            <div class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-3">
              <div>
                <h3 class="h6 fw-bold">ABC Travels</h3>
                <p class="mb-0 text-muted">Preeti Nagar,<br/>Lucknow, India<br/>Phone: +91 123456789</p>
              </div>
              <div class="invoice-logo">
                <img src="https://raw.githubusercontent.com/easylauncher/assets/refs/heads/main/logo/EasyLauncherLogo02/LogoWithoutText/logo02.svg" alt="Company Logo" crossorigin="anonymous">
              </div>
            </div>

            <div class="mb-4">
              <h4 class="h6 fw-bold">Invoice Details</h4>
              <table class="table table-sm table-striped table-borderless">
                <thead class="table-light">
                  <tr>
                    <th>Journey Start Date</th>
                    <th>Journey End Date</th>
                    <th>Distance Covered (KM)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td id="displayStartDate"></td>
                    <td id="displayEndDate"></td>
                    <td id="displayDistance"></td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="mb-4">
              <h4 class="h6 fw-bold">Cost Summary</h4>
              <table class="table table-sm table-borderless w-auto ms-auto text-end">
                <tbody>
                  <tr>
                    <td class="fw-semibold">Cost per KM:</td>
                    <td id="displayCostPerKm"></td>
                  </tr>
                  <tr>
                    <td class="fw-semibold">Toll:</td>
                    <td id="displayToll"></td>
                  </tr>
                  <tr>
                    <td class="fw-semibold">Extra Expenses:</td>
                    <td id="displayExtras"></td>
                  </tr>
                  <tr class="border-top">
                    <td class="fw-bold">Total Cost:</td>
                    <td id="displayTotal"></td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="text-end mt-3">
              <p class="mb-0">Thank you for using our service!</p>
            </div>

            <div class="text-center mt-4" style="font-size:0.8rem;">
              &copy; EasyLauncher.net . All rights reserved.
            </div>

          </div>

          <!-- Action Buttons Start -->
          <div class="download-btn text-center mt-4 d-none">
            <button id="downloadPdf" class="btn btn-success me-2">Download as PDF</button>
            <button id="shareInvoice" class="btn btn-success me-2">Share Invoice</button>
            <button id="printInvoice" class="btn btn-outline-primary">Print Invoice</button>
            <button type="button" class="btn btn-outline-primary">Primary</button>
          </div>
          <!-- Action Buttons End -->
          
        </div>
      </div>

    </div>
    <!-- Invoice Section End -->

  </div>
</div>

<footer class="text-center py-3 mt-5" style="font-size:0.8rem; background: #f1f1f1;">
  &copy; 2024 <a href="https://EasyLauncher.net" target="_blank" rel="noopener noreferrer">EasyLauncher.net</a>. All rights reserved.
</footer>


<!-- Required JS -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-7XuMYTRHcXyMN1c6MfJsc8ZaaTHr3fu4mxAw/knKA/zUwi3jHnuD32roP9cl/c2BOxGWDFbWs5n+ZLqz2tGdmg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" referrerpolicy="no-referrer"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-BuZV0Wno7SqfZkHDZT/N+7SwMkMyNPRnsHFKgu4pBaetWPgnablNGP0Z26G7NkfWJ+lnx9Pf3I7+QI6+tWjk4g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" referrerpolicy="no-referrer"></script>

<script>
  const generateBtn = document.getElementById('generateBtn');
  const invoiceEl = document.getElementById('invoice');
  const downloadPdfBtn = document.getElementById('downloadPdf');
  const shareBtn = document.getElementById('shareInvoice');
  const printInvoiceBtn = document.getElementById('printInvoice');

  // If TEST_MODE is true, populate form with sample values on load
  document.addEventListener('DOMContentLoaded', () => {
    if (TEST_MODE) {
      document.getElementById('startDate').value = '2024-12-01';
      document.getElementById('startMeter').value = '1200';
      document.getElementById('endDate').value = '2024-12-02';
      document.getElementById('endMeter').value = '1480';
      document.getElementById('toll').value = '150';
      document.getElementById('extras').value = '100';
      document.getElementById('costPerKm').value = '11';
    }
  });

  generateBtn.addEventListener('click', () => {
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    const startMeter = parseFloat(document.getElementById('startMeter').value);
    const endMeter = parseFloat(document.getElementById('endMeter').value);
    const toll = parseFloat(document.getElementById('toll').value) || 0;
    const extras = parseFloat(document.getElementById('extras').value) || 0;
    const costPerKm = parseFloat(document.getElementById('costPerKm').value);

    if(!startDate || !endDate || isNaN(startMeter) || isNaN(endMeter) || isNaN(costPerKm)) {
      alert('Please fill in all required fields properly.');
      return;
    }

    const distance = endMeter - startMeter;
    if(distance < 0) {
      alert('End meter reading should be greater than or equal to start meter reading.');
      return;
    }

    const travelCost = distance * costPerKm;
    const totalCost = travelCost + toll + extras;

    // Populate invoice fields
    document.getElementById('displayStartDate').textContent = startDate;
    document.getElementById('displayEndDate').textContent = endDate;
    document.getElementById('displayDistance').textContent = distance.toFixed(2) + ' KM';
    document.getElementById('displayCostPerKm').textContent = costPerKm.toFixed(2);
    document.getElementById('displayToll').textContent = toll.toFixed(2);
    document.getElementById('displayExtras').textContent = extras.toFixed(2);
    document.getElementById('displayTotal').textContent = totalCost.toFixed(2);

    invoiceEl.classList.remove('d-none');
    document.querySelector('.download-btn').classList.remove('d-none');
  });

  downloadPdfBtn.addEventListener('click', async () => {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'pt', 'a4');

    // Short delay to ensure images/fonts are loaded
    await new Promise(res => setTimeout(res, 300));

    const now = new Date();
    const fileName = `invoice_${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}-${String(now.getHours()).padStart(2,'0')}-${String(now.getMinutes()).padStart(2,'0')}-${String(now.getSeconds()).padStart(2,'0')}.pdf`;

    await pdf.html(invoiceEl, {
      callback: function (pdf) {
        pdf.save(fileName);
      },
      autoPaging: true,
      x: 10,
      y: 10,
      html2canvas: {
        useCORS: true,
        scale: 2
      }
    });
  });

  shareBtn.addEventListener('click', async () => {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'pt', 'a4');

    await new Promise(res => setTimeout(res, 300));

    await pdf.html(invoiceEl, {
      autoPaging: true,
      x: 10,
      y: 10,
      html2canvas: {
        useCORS: true,
        scale: 2
      }
    });

    const blob = pdf.output('blob');
    const file = new File([blob], "invoice.pdf", {type:'application/pdf'});

    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      try {
        await navigator.share({
          title: 'Invoice',
          text: 'Please find attached your invoice.',
          files: [file]
        });
      } catch (err) {
        alert('Sharing was cancelled or failed.');
      }
    } else {
      alert("Sharing not supported. Please download the PDF and share manually.");
    }
  });

  printInvoiceBtn.addEventListener('click', () => {
    window.print();
  });
  

</script>

<!-- Bootstrap 5 JS (no jQuery needed) -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
